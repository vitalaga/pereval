![image](https://lms-cdn.skillfactory.ru/assets/courseware/v1/6ce6d0d69d2954ea1ef1511b7c4c6fca/asset-v1:SkillFactory+PDEV+2021+type@asset+block/virt_intern_start_2.1.svg)

# <span style="color:green">Pereval REST API</span>

___
**Pereval REST API** реализован для приложений на Android и IOS сервиса [pereval.online](https://pereval.online/). 
Программа упростит отправку данных о перевале и сократит время обработки запроса до трёх дней.

Пользоваться мобильным приложением будут туристы. В горах они будут вносить данные о перевале в приложение и отправлять 
их в ***pereval.online***, как только появится доступ в Интернет.

Модератор из федерации будет верифицировать и вносить в базу данных информацию, полученную от пользователей, а те в 
свою очередь смогут увидеть в мобильном приложении статус модерации и просматривать базу с объектами, внесёнными 
другими.

---
Когда турист поднимется на перевал, он сфотографирует его и внесёт нужную информацию с помощью мобильного приложения:

+ координаты объекта и его высоту;
+ название объекта;
+ несколько фотографий;
+ информацию о пользователе, который передал данные о перевале:
  + имя пользователя (ФИО строкой);
  + почта;
  + телефон.

После этого турист нажмёт кнопку «Отправить» в мобильном приложении. Мобильное приложение вызовет метод **Pereval**.

---
### **Метод** ***<span style="color:green"> POST/Pereval/</span>***

Метод **Pereval** принимает JSON в теле запроса с информацией о перевале. Ниже находится пример такого JSON-а:

```
{
  "beauty_title": "пер. ",
  "title": "Пхия",
  "other_titles": "Триев",
  "connect": "", //что соединяет, текстовое поле
 
  "add_time": "2021-09-22 13:18:13",
  "user": {"email": "qwerty@mail.ru", 		
        "fam": "Пупкин",
		 "name": "Василий",
		 "otc": "Иванович",
        "phone": "+7 555 55 55"}, 
 
   "coords":{
  "latitude": "45.3842",
  "longitude": "7.1525",
  "height": "1200"}
 
 
  level:{"winter": "", //Категория трудности. В разное время года перевал может иметь разную категорию трудности
  "summer": "1А",
  "autumn": "1А",
  "spring": ""},
 
   images: [{image:"<картинка1>", title:"Седловина"}, {image:"<картинка>", title:"Подъём"}]
}
```

**Результат метода: JSON**

+ ***status*** — *код HTTP, целое число:*

   + 500 — ошибка при выполнении операции;

   + 400 — Bad Request (при нехватке полей);*

   + 200 — успех.

+ ***message*** — *строка*:

  + Причина ошибки (если она была);

  + Отправлено успешно;

  + Если отправка успешна, дополнительно возвращается id вставленной записи.

  + id — идентификатор, который был присвоен объекту при добавлении в базу данных.

Примеры:

```
{ "status": 500, "message": "Ошибка подключения к базе данных","id": null}
{ "status": 200, "message": null, "id": 42 }
```

Допустимые значения поля ***status***:

+ **new**;
+ **pending** — если модератор взял в работу;
+ **accepted** — модерация прошла успешно;
+ **rejected** — модерация прошла, информация не принята.

---
### **Метод** ***<span style="color:green">GET/Pereval/<id></span>***

Получает одну запись (перевал) по её id, с выводом всей информации об объекте, в том числе статус модерации.

---
### **Метод** ***<span style="color:green">PATCH/Pereval/< id ></span>***

Позволяет отредактировать существующую запись (замена), если она в статусе new.
Редактировать можно все поля, кроме тех, что содержат в себе ФИО, адрес почты и номер телефона.

В качестве результата возвращаются два значения:
+ ***state***:
  + **1** — если успешно удалось отредактировать запись в базе данных.
  + **0** — в противном случае.
+ ***message*** — если обновить запись не удалось, напиши почему.

---
### **Метод** ***<span style="color:green">GET/Pereval/?user__email=< email ></span>***

Получает список данных обо всех объектах, которые пользователь с почтой <email> отправил на сервер.


